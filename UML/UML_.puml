@startuml BatailleNavale_Finale_V4
skinparam style strictuml
skinparam linetype ortho
skinparam classAttributeIconSize 0
skinparam classFontStyle Bold
hide enum methods
top to bottom direction

' --- PACKAGE MODEL ---
package Model {

  class GameConfiguration {
    - gridSize: int
    - boatCounts: Map<BoatType, Integer>
    - isIslandMode: boolean
  }

  class Coordinates {
    - row: int
    - column: int
  }

  enum HitOutcome {
    MISS, HIT, SUNK, TRAP_TRIGGERED, ACQUIRED_WEAPON, INVALID
  }

  interface GridEntity <<interface>> {
    + handleImpact(attacker: Player, coords: Coordinates): HitOutcome
    + entityType(): String
    + size(): int
  }

  package Map {
    class Grid {
      - size: int
      - cells: GridCell[][]
      + getCell(coord: Coordinates): GridCell
      + getSize(): int
      + markIslandZone(startRow: int, startCol: int)
    }

    class GridCell {
      - entity: GridEntity
      - isHit: boolean
      - boatSegmentIndex: int
      - isIslandCell: boolean
      + strike(attacker: Player): HitOutcome
      + isIslandCell(): boolean
      + setIsIslandCell(flag: boolean)
    }

    Grid "1" *-- "*" GridCell
    GridCell o-- GridEntity
  }

  package Player {
    abstract class Player {
      - ownGrid: Model.Map.Grid
      - targetGrid: Model.Map.Grid
      + fire(coords: Coordinates): HitOutcome
      + handleIncomingFire(coords: Coordinates): HitOutcome
      + isDefeated(): boolean
    }

    class HumanPlayer extends Player {
      - bombCount: int
      - sonarCount: int
      + addBomb()
      + hasBomb(): boolean
      + useBomb()
      + addSonar()
      + hasSonar(): boolean
      + useSonar()
      + isSubmarineAlive(): boolean
    }

    class ComputerPlayer extends Player {
      - shotStrategy: ShotStrategy
      + chooseNextShot(lastOutcome: HitOutcome): Coordinates
      + getShotStrategy(): ShotStrategy
    }

    interface ShotStrategy <<interface>> {
      + getNextShot(grid: Model.Map.Grid, lastOutcome: HitOutcome): Coordinates
    }

    class RandomShotStrategy implements ShotStrategy
    class TargetedShotStrategy implements ShotStrategy
  }

  package Boat {
    enum BoatType {
      AIRCRAFT_CARRIER, CRUISER, DESTROYER, SUBMARINE, TORPEDO
    }

    interface Boat extends Model.GridEntity {
      + receiveHit(index: int): HitOutcome
      + isSunk(): boolean
      + size(): int
      + name(): String
      + getType(): BoatType
    }

    class AircraftCarrier implements Boat
    class Cruiser implements Boat
    class Destroyer implements Boat
    class Submarine implements Boat
    class TorpedoBoat implements Boat
  }

  package Island {
    interface IslandItem extends GridEntity {
      + onAcquired(player: Player): HitOutcome
    }

    class BombItem implements IslandItem
    class SonarItem implements IslandItem
    class IslandEmpty implements IslandItem
  }

  package Trap {
    class BlackHole implements GridEntity {
      - size: int
      - isTriggered: boolean
      + onTriggered(): HitOutcome
    }

    class Tornado implements GridEntity {
      - size: int
      - isTriggered: boolean
      + onTriggered(): HitOutcome
    }
  }

  package Weapons {
    interface Weapon <<interface>> {
    }

    class Bomb {
      + use(targetGrid: Model.Map.Grid, target: Coordinates, attacker: Player)
    }

    class Sonar {
      + scan(targetGrid: Model.Map.Grid, target: Coordinates): int
    }

    class Missile {
    }
  }
}

' --- PACKAGE CONTROLLER ---
package Controller {

  interface Observer <<interface>> {
    + update(event: Object)
  }

  class GameController implements Observer {
    - config: Model.GameConfiguration
    - playerGrid: Model.Map.Grid
    - enemyGrid: Model.Map.Grid
    - observers: java.util.List<Observer>
    + startApplication()
    + handleConfigurationComplete(config: GameConfiguration)
    + showBattleView()
    + notifyObservers(event: Object)
    + log(message: String)
    + applyTornadoEffect(coord: Model.Coordinates): Model.Coordinates
    + getBattleController(): BattleController
  }

  class BattleController implements Observer {
    - mainController: GameController
    - targetGrid: Model.Map.Grid
    + handlePlayerAttack(row: int, col: int): Model.HitOutcome
    + selectWeapon(mode: WeaponMode)
    enum WeaponMode { MISSILE, BOMB, SONAR }
  }

  class PlacementController implements Observer {
    - mainController: GameController
    + handleGridClick(row: int, col: int)
    + initializeBoats(config: Model.GameConfiguration)
    + toggleOrientation()
  }

  class ConfigurationController implements Observer {
    - mainController: GameController
    + handleConfigurationComplete(config: Map, island: boolean)
  }

  GameController "1" o--> "*" Observer : notifies >
  GameController --> BattleController : uses
  GameController --> PlacementController : uses
  GameController --> ConfigurationController : uses

  GameController --> Model.GameConfiguration : uses
  GameController --> Model.Map.Grid : manages
  GameController ..> Model.Coordinates : uses
  BattleController ..> Model.HitOutcome : uses
  BattleController ..> Model.Coordinates : uses
}

' --- PACKAGE VIEW ---
package View {

  class BattleView implements Controller.Observer {
    - controller: Controller.GameController
    - playerBattleGrid: BattleGrid
    - enemyBattleGrid: BattleGrid
    - infoPanel: InfoPanel
    + display()
    + update(event: Object)
  }

  class PlacementView implements Controller.Observer {
    - controller: Controller.PlacementController
    + display()
    + update(event: Object)
  }

  class ConfigurationView {
    - controller: Controller.ConfigurationController
    + display()
  }

  class EndGameView {
    - controller: Controller.GameController
    + display()
  }

  class InfoPanel {
    + updateStats(turnNumber: int, human: Model.Player.HumanPlayer, computer: Model.Player.ComputerPlayer)
    + addLog(message: String)
  }

  class BattleGrid {
    - gridCells: GridCell[][]
  }

  class GridCell_View as "GridCell" {
    - state: CellState
    + setState(state: CellState)
  }

  enum CellState {
    WATER, BOAT, HIT, MISS, SUNK, ISLAND, EXPLORED, ITEM_FOUND, TRAP
  }

  BattleView --> Controller.GameController : uses
  PlacementView --> Controller.PlacementController : uses
  ConfigurationView --> Controller.ConfigurationController : uses
  BattleView *-- BattleGrid
  BattleView *-- InfoPanel
  BattleView ..> EndGameView
  BattleGrid *-- GridCell_View
  GridCell_View --> CellState : uses
}

' --- RELATIONS INTER-PACKAGES GLOBALES ---
Controller.Observer <|.. View.BattleView
Controller.Observer <|.. View.PlacementView

Model.Map.Grid ..> Model.Coordinates
Model.Player.Player ..> Model.HitOutcome
Model.Player.Player ..> Model.Coordinates

@enduml

